@model Unistay_Web.Models.Room.Room
@{
    ViewData["Title"] = "Đăng tin mới";
}

<div class="container py-5" style="max-width: 900px;">
    <!-- Page Header -->
    <div class="text-center mb-5 animate-fade-in-up">
        <h1 class="display-5 fw-bold text-gradient">Đăng tin mới</h1>
        <p class="text-muted lead">Chọn loại tin bạn muốn đăng để bắt đầu</p>
    </div>

    <!-- Role Selection Tabs -->
    <div class="glass-panel p-1 mb-5 d-flex justify-content-center animate-fade-in-up" style="max-width: 600px; margin: 0 auto; border-radius: 50px;">
        <ul class="nav nav-pills nav-fill w-100" id="postTypeTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active rounded-pill fw-bold py-3" id="landlord-tab" data-bs-toggle="pill" data-bs-target="#landlord" type="button" role="tab" aria-selected="true">
                    <i class="bi bi-house-door me-2"></i>Cho thuê phòng
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link rounded-pill fw-bold py-3" id="seeker-tab" data-bs-toggle="pill" data-bs-target="#seeker" type="button" role="tab" aria-selected="false">
                    <i class="bi bi-person-search me-2"></i>Tìm phòng / Ở ghép
                </button>
            </li>
        </ul>
    </div>

    <div class="tab-content" id="postTypeTabContent">
        <!-- LANDLORD FORM (Room Listing) -->
        <div class="tab-pane fade show active animate-fade-in" id="landlord" role="tabpanel" aria-labelledby="landlord-tab">
            <div class="glass-panel p-4 p-md-5">
                <div class="d-flex align-items-center mb-4 pb-3 border-bottom border-light">
                    <div class="bg-primary-soft p-3 rounded-circle me-3 text-primary">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    </div>
                    <div>
                        <h4 class="fw-bold mb-0">Thông tin phòng cho thuê</h4>
                        <p class="text-muted small mb-0">Điền đầy đủ thông tin để thu hút người thuê</p>
                    </div>
                </div>

                <form asp-action="Create" method="post" enctype="multipart/form-data">
                    <!-- Basic Info -->
                    <h6 class="fw-bold text-primary mb-3 text-uppercase small ls-1">Cơ bản</h6>
                    <div class="row g-4 mb-4">
                         <div class="col-12">
                            <label class="form-label fw-bold">Tiêu đề bài đăng <span class="text-danger">*</span></label>
                            <input asp-for="Title" class="form-control form-control-lg bg-light border-0" placeholder="VD: Phòng trọ cao cấp, full nội thất tại Quận 1" />
                            <span asp-validation-for="Title" class="text-danger small"></span>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-bold">Địa chỉ chi tiết <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0"><i class="bi bi-geo-alt text-primary"></i></span>
                                <input asp-for="Address" class="form-control form-control-lg bg-light border-0" placeholder="Số nhà, tên đường, phường/xã, quận/huyện..." />
                            </div>
                            <span asp-validation-for="Address" class="text-danger small"></span>
                        </div>
                         <div class="col-12">
                            <label class="form-label fw-bold">Mô tả chi tiết <span class="text-danger">*</span></label>
                            <textarea asp-for="Description" class="form-control bg-light border-0" rows="5" placeholder="Mô tả về phòng, tiện ích, giờ giấc, nội thất..."></textarea>
                            <span asp-validation-for="Description" class="text-danger small"></span>
                        </div>
                    </div>

                    <!-- Pricing & Specs -->
                     <h6 class="fw-bold text-primary mb-3 text-uppercase small ls-1 mt-5">Chi phí & Thông số</h6>
                     <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Giá thuê (VNĐ/tháng) <span class="text-danger">*</span></label>
                            <input asp-for="Price" type="number" class="form-control form-control-lg bg-light border-0" placeholder="0" />
                            <span asp-validation-for="Price" class="text-danger small"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Tiền cọc (VNĐ)</label>
                            <input asp-for="Deposit" type="number" class="form-control form-control-lg bg-light border-0" placeholder="0" />
                        </div>
                         <div class="col-md-6">
                            <label class="form-label fw-bold">Diện tích (m²) <span class="text-danger">*</span></label>
                            <input asp-for="Area" type="number" class="form-control form-control-lg bg-light border-0" placeholder="0" />
                        </div>
                         <div class="col-md-6">
                            <label class="form-label fw-bold">Số người tối đa</label>
                            <input asp-for="MaxOccupants" type="number" class="form-control form-control-lg bg-light border-0" value="1" />
                        </div>
                     </div>

                    <!-- Images -->
                    <h6 class="fw-bold text-primary mb-3 text-uppercase small ls-1 mt-5">Hình ảnh</h6>
                    <div class="mb-4">
                        <label for="imageUpload" class="d-block p-5 text-center bg-light border-dashed rounded-3 cursor-pointer hover-bg-light-dark transition-all">
                            <div class="mb-3 text-primary"><i class="bi bi-cloud-arrow-up display-4"></i></div>
                            <h6 class="fw-bold">Kéo thả hoặc click để tải ảnh lên</h6>
                            <small class="text-muted">Hỗ trợ JPG, PNG (Tối đa 5MB)</small>
                        </label>
                        <input type="file" id="imageUpload" name="imageFiles" multiple accept="image/*" class="d-none" />
                        <div class="image-gallery mt-3 d-flex flex-wrap gap-2" id="previewGallery"></div>
                    </div>

                    <!-- Amenities -->
                    <h6 class="fw-bold text-primary mb-3 text-uppercase small ls-1 mt-5">Tiện ích</h6>
                    <div class="row g-3 mb-5">
                         @{
                            var amenities = new[] { 
                                new { id="wifi", label="Wifi", icon="bi-wifi" },
                                new { id="ac", label="Máy lạnh", icon="bi-snow" },
                                new { id="wc", label="WC riêng", icon="bi-droplet" },
                                new { id="parking", label="Giữ xe", icon="bi-bicycle" },
                                new { id="security", label="An ninh", icon="bi-shield-check" },
                                new { id="kitchen", label="Bếp", icon="bi-egg-fried" }
                            };
                        }
                        @foreach(var item in amenities) {
                            <div class="col-6 col-md-4 col-lg-3">
                                <label class="amenity-card p-3 border rounded-3 d-flex align-items-center gap-2 cursor-pointer bg-white h-100 transition-all">
                                    <input type="checkbox" class="form-check-input" name="selectedAmenities" value="@item.id" @(Model?.Amenities?.Contains(item.id) == true ? "checked" : "") />
                                    <i class="bi @item.icon text-primary"></i>
                                    <span class="fw-medium">@item.label</span>
                                </label>
                            </div>
                        }
                    </div>

                    <div class="d-flex justify-content-end gap-3 pt-4 border-top">
                        <a asp-action="Index" class="btn btn-light rounded-pill px-4">Hủy bỏ</a>
                        <button type="submit" class="btn btn-primary rounded-pill px-5 fw-bold shadow-sm hover-translate-up">Đăng tin ngay</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- SEEKER FORM (Roommate Profile) -->
        <div class="tab-pane fade animate-fade-in" id="seeker" role="tabpanel" aria-labelledby="seeker-tab">
             <div class="glass-panel p-4 p-md-5">
                <div class="d-flex align-items-center mb-4 pb-3 border-bottom border-light">
                    <div class="bg-info-soft p-3 rounded-circle me-3 text-info">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                    </div>
                    <div>
                        <h4 class="fw-bold mb-0">Hồ sơ tìm phòng / Ở ghép</h4>
                        <p class="text-muted small mb-0">Tạo hồ sơ để tìm kiếm người bạn cùng phòng phù hợp</p>
                    </div>
                </div>

                <form asp-controller="Roommates" asp-action="Create" method="post" enctype="multipart/form-data">
                     <!-- Personal Info -->
                    <h6 class="fw-bold text-info mb-3 text-uppercase small ls-1">Thông tin cá nhân</h6>
                    <div class="row g-4 mb-4 align-items-center">
                        <div class="col-md-3 text-center">
                             <label for="avatarUpload" class="d-inline-block position-relative cursor-pointer group">
                                <div class="avatar-placeholder rounded-circle bg-light d-flex align-items-center justify-content-center border-dashed overflow-hidden" style="width: 120px; height: 120px;">
                                    @if(ViewBag.UserAvatar != null) {
                                         <img id="seekerAvatarPreview" src="@ViewBag.UserAvatar" class="w-100 h-100 object-fit-cover" />
                                    } else {
                                        <i class="bi bi-camera display-6 text-muted" id="seekerAvatarIcon"></i>
                                        <img id="seekerAvatarPreview" class="w-100 h-100 object-fit-cover d-none" />
                                    }
                                </div>
                                <div class="position-absolute bottom-0 end-0 bg-white shadow-sm p-1 rounded-circle border">
                                    <i class="bi bi-pencil-fill small text-muted"></i>
                                </div>
                            </label>
                            <input type="file" id="avatarUpload" name="avatarUpload" class="d-none" accept="image/*">
                            <div class="small text-muted mt-2">Ảnh đại diện</div>
                        </div>
                        <div class="col-md-9">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-bold">Họ và tên</label>
                                    <input type="text" name="FullName" class="form-control bg-light border-0" value="@ViewBag.UserFullName" />
                                </div>
                                <div class="col-6">
                                    <label class="form-label fw-bold">Năm sinh</label>
                                    <input type="number" name="BirthYear" class="form-control bg-light border-0" value="@ViewBag.UserBirthYear" />
                                </div>
                                 <div class="col-6">
                                    <label class="form-label fw-bold">Giới tính</label>
                                    <select name="Gender" class="form-select bg-light border-0">
                                        <option value="">Chọn...</option>
                                        <!option value="Male" @(ViewBag.UserGender == "Male" ? "selected" : "")>Nam</!option>
                                        <!option value="Female" @(ViewBag.UserGender == "Female" ? "selected" : "")>Nữ</!option>
                                        <!option value="Other" @(ViewBag.UserGender == "Other" ? "selected" : "")>Khác</!option>
                                    </select>
                                </div>
                                <div class="col-12">
                                     <label class="form-label fw-bold">Trường học / Nghề nghiệp</label>
                                    <input type="text" name="Occupation" class="form-control bg-light border-0" value="@ViewBag.UserOccupation" />
                                </div>
                            </div>
                        </div>
                         <div class="col-12">
                             <label class="form-label fw-bold">Giới thiệu bản thân</label>
                             <textarea name="Introduction" class="form-control bg-light border-0" rows="3" placeholder="Sở thích, tính cách, thói quen sinh hoạt...">@ViewBag.UserBio</textarea>
                         </div>
                    </div>

                    <!-- Preferences -->
                     <h6 class="fw-bold text-info mb-3 text-uppercase small ls-1 mt-5">Mong muốn tìm bạn</h6>
                     <div class="row g-4 mb-4">
                        <div class="col-md-6">
                             <label class="form-label fw-bold">Khu vực mong muốn</label>
                             <input type="text" name="PreferredArea" class="form-control bg-light border-0" placeholder="Quận / Khu vực..." />
                        </div>
                        <div class="col-md-6">
                             <label class="form-label fw-bold">Ngân sách tối đa (VNĐ)</label>
                             <input type="number" name="Budget" class="form-control bg-light border-0" placeholder="0" />
                        </div>
                        <div class="col-md-6">
                             <label class="form-label fw-bold">Ngày dự kiến chuyển vào</label>
                             <input type="date" name="MoveInDate" class="form-control bg-light border-0" />
                        </div>
                     </div>

                     <!-- Habits -->
                     <h6 class="fw-bold text-info mb-3 text-uppercase small ls-1 mt-5">Thói quen & Lối sống</h6>
                     <div class="d-flex flex-wrap gap-2 mb-5">
                          @{
                            var habits = new[] { "Không hút thuốc", "Gọn gàng", "Yên tĩnh", "Thích nấu ăn", "Thân thiện", "Thích thú cưng", "Ngủ sớm", "Tiệc tùng" };
                        }
                        @foreach(var h in habits) {
                            <label class="habit-chip">
                                <input type="checkbox" name="HabitsList" value="@h" class="d-none habit-checkbox">
                                <span class="px-3 py-2 rounded-pill border d-inline-block cursor-pointer bg-white transition-all">@h</span>
                            </label>
                        }
                         <input type="hidden" name="Habits" id="HabitsInput" />
                     </div>

                    <div class="d-flex justify-content-end gap-3 pt-4 border-top">
                        <a asp-action="Index" class="btn btn-light rounded-pill px-4">Hủy bỏ</a>
                        <button type="submit" class="btn btn-info text-white rounded-pill px-5 fw-bold shadow-sm hover-translate-up">Tạo hồ sơ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Tab Persistence if needed, or simple JS
        
        // Image Upload Preview (Landlord)
        const imageUpload = document.getElementById('imageUpload');
        const previewGallery = document.getElementById('previewGallery');
        if(imageUpload) {
            imageUpload.addEventListener('change', function() {
                previewGallery.innerHTML = '';
                Array.from(this.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                         const img = document.createElement('img');
                         img.src = e.target.result;
                         img.className = 'rounded-3 object-fit-cover shadow-sm';
                         img.style.width = '100px';
                         img.style.height = '100px';
                         previewGallery.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                });
            });
        }

        // Seeker Avatar Preview
        const avatarUpload = document.getElementById('avatarUpload');
        const seekerAvatarPreview = document.getElementById('seekerAvatarPreview');
        const seekerAvatarIcon = document.getElementById('seekerAvatarIcon');
        
        if(avatarUpload) {
            avatarUpload.addEventListener('change', function() {
                 if (this.files && this.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        seekerAvatarPreview.src = e.target.result;
                        seekerAvatarPreview.classList.remove('d-none');
                        if(seekerAvatarIcon) seekerAvatarIcon.classList.add('d-none');
                    }
                    reader.readAsDataURL(this.files[0]);
                }
            });
        }

        // Habits Logic
        const habitCheckboxes = document.querySelectorAll('.habit-checkbox');
        const habitsInput = document.getElementById('HabitsInput');
        
        function updateHabits() {
            const selected = Array.from(habitCheckboxes)
                .filter(cb => cb.checked)
                .map(cb => cb.value);
            if(habitsInput) habitsInput.value = selected.join(', ');
            
            // Visual feedback
             habitCheckboxes.forEach(cb => {
                 const span = cb.nextElementSibling;
                 if(cb.checked) {
                     span.classList.add('bg-info', 'text-white', 'border-info');
                     span.classList.remove('bg-white');
                 } else {
                     span.classList.remove('bg-info', 'text-white', 'border-info');
                     span.classList.add('bg-white');
                 }
             });
        }
        
        habitCheckboxes.forEach(cb => cb.addEventListener('change', updateHabits));
    </script>
    <style>
        .amenity-card:hover {
            border-color: var(--bs-primary) !important;
            background-color: var(--bs-light) !important;
        }
        .amenity-card input:checked + i + span {
            color: var(--bs-primary);
            font-weight: 700;
        }
        .border-dashed { border-style: dashed !important; }
        .bg-primary-soft { background: rgba(var(--primary-rgb), 0.1); }
        .bg-info-soft { background: rgba(13, 202, 240, 0.1); }
        .hover-translate-up:hover { transform: translateY(-3px); }
        .transition-all { transition: all 0.3s ease; }
    </style>
}