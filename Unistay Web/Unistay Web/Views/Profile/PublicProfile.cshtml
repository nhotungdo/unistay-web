@model Unistay_Web.Models.User.UserProfile
@{
    ViewData["Title"] = $"{Model.FullName}'s Profile";
}

<section class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-8">
                <!-- Profile Card -->
                <div class="card card-elevated overflow-hidden">
                    <div class="position-relative h-40 bg-gradient-to-r from-primary-500 to-primary-700"></div>

                    <div class="card-body p-5 pt-0">
                        <div class="row align-items-end">
                            <div class="col-auto">
                                <div class="position-relative d-inline-block mt-n6">
                                    @if (!string.IsNullOrEmpty(Model.AvatarUrl))
                                    {
                                        <img src="@Model.AvatarUrl" class="rounded-circle border-4 border-white shadow-lg"
                                            width="150" height="150" alt="@Model.FullName" style="object-fit: cover;">
                                    }
                                    else
                                    {
                                        <img src="https://ui-avatars.com/api/?name=@(Model.FullName?.Replace(" ", "+") ?? "User")&background=random&size=150"
                                            class="rounded-circle border-4 border-white shadow-lg" width="150" height="150"
                                            alt="@Model.FullName">
                                    }
                                </div>
                            </div>
                            <div class="col">
                                <h1 class="h3 mb-1">@Model.FullName</h1>
                                <p class="text-muted mb-3">@(Model.Occupation ?? "Thành viên UniStay")</p>
                                <div class="d-flex gap-2 flex-wrap">
                                    <span class="badge badge-primary px-3 py-2 rounded-pill">
                                        @(User?.FindFirst("http://schemas.microsoft.com/ws/2008/06/identity/claims/role")?.Value
                                                                                == "Landlord" ? "Chủ trọ" : "Người tìm trọ")
                                    </span>
                                    @if (Model.EmailConfirmed)
                                    {
                                        <span
                                            class="badge badge-success px-3 py-2 rounded-pill d-flex align-items-center gap-1">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <polyline points="20 6 9 17 4 12"></polyline>
                                            </svg>
                                            Verified User
                                        </span>
                                    }
                                    @if (Model.IsVerified)
                                    {
                                        <span
                                            class="badge badge-info px-3 py-2 rounded-pill d-flex align-items-center gap-1">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path
                                                    d="M22 11.08V5a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                </path>
                                                <path d="M16 3v4"></path>
                                                <path d="M8 3v4"></path>
                                                <path d="M4 11h16"></path>
                                            </svg>
                                            ID Verified
                                        </span>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Info -->
                <div class="card mt-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Thông tin</h5>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center p-3 bg-light rounded mb-3">
                                    <h3 class="mb-0">@Model.TotalListings</h3>
                                    <small class="text-muted">Bài đăng</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center p-3 bg-light rounded mb-3">
                                    <h3 class="mb-0">@Model.TotalReviews</h3>
                                    <small class="text-muted">Đánh giá</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center p-3 bg-light rounded mb-3">
                                    <h3 class="mb-0">@Model.AverageRating.ToString("0.0")</h3>
                                    <small class="text-muted">Xếp hạng</small>
                                </div>
                            </div>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.Bio))
                        {
                            <hr>
                            <h6 class="text-muted text-uppercase small mb-2">Về tôi</h6>
                            <p>@Model.Bio</p>
                        }

                        @if (!string.IsNullOrEmpty(Model.Lifestyle))
                        {
                            <hr>
                            <h6 class="text-muted text-uppercase small mb-2">Lối sống</h6>
                            <p>@Model.Lifestyle</p>
                        }

                        <hr>

                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-muted text-uppercase small mb-2">Khu vực tìm kiếm</h6>
                                <p class="small">@(Model.LivingArea ?? "Chưa cập nhật")</p>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-muted text-uppercase small mb-2">Ngân sách</h6>
                                <p class="small">@(Model.Budget.HasValue? Model.Budget.Value.ToString("C0") : "Chưa cập nhật")</p>
                            </div>
                        </div>

                        <hr>

                        <div class="text-muted small">
                            <p class="mb-0">
                                <strong>Thành viên từ:</strong>
                                @Model.CreatedAt.ToString("dd/MM/yyyy")
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                @if (ViewBag.Activities != null &&
                                ((List<Unistay_Web.Models.User.ActivityHistory>)ViewBag.Activities).Count > 0)
                {
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="mb-0">Hoạt động gần đây</h5>
                        </div>
                        <div class="card-body">
                            @foreach (var activity in (List<Unistay_Web.Models.User.ActivityHistory>)ViewBag.Activities)
                            {
                                <div class="mb-3 pb-3 border-bottom">
                                    <p class="mb-1">
                                        <strong>@GetActivityLabel(activity.ActivityType)</strong>
                                    </p>
                                    <small class="text-muted">@activity.ActivityDate.ToString("dd/MM/yyyy HH:mm")</small>
                                </div>
                            }
                        </div>
                    </div>
                }

                <div class="mt-4">
                    <a href="@Url.Action("Index", "Home")" class="btn btn-outline-secondary">Quay lại</a>
                </div>
            </div>
        </div>
    </div>
</section>

@functions {
    private string GetActivityLabel(string activityType)
    {
        return activityType switch
        {
            "ListingCreated" => "Tạo bài đăng",
            "ReviewSubmitted" => "Gửi đánh giá",
            "ProfileUpdate" => "Cập nhật hồ sơ",
            "ChatInitiated" => "Bắt đầu trò chuyện",
            _ => "Hoạt động"
        };
    }
}