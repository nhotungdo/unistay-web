@{
    ViewData["Title"] = "Xác Minh Tài Sản Của Bạn";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<div class="onboarding-container fade-in">
    <div class="glass-panel mx-auto col-lg-8 p-0 overflow-hidden">
        <!-- Progress Bar -->
        <div class="progress" style="height: 6px; border-radius: 0;">
            <div class="progress-bar bg-warning" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
        </div>

        <div class="p-5">
            <div class="text-center mb-5">
                <h2 class="fw-bold">Xác Minh Tài Sản</h2>
                <p class="text-muted">Để đảm bảo tin cậy, chúng tôi cần xác minh vị trí và thông tin liên hệ của bạn.</p>
            </div>

            <form asp-action="LandlordVerify" method="post" id="landlordForm">
                <div class="row g-4">
                    <!-- Address Section -->
                    <div class="col-md-6">
                        <h5 class="fw-bold mb-3">Chi Tiết Địa Chỉ</h5>
                        <div class="mb-3">
                            <label class="form-label">Tỉnh / Thành phố</label>
                            <input type="text" name="city" class="form-control bg-light" placeholder="VD: TP. Hồ Chí Minh" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quận / Huyện</label>
                            <input type="text" name="district" class="form-control bg-light" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phường / Xã</label>
                            <input type="text" name="ward" class="form-control bg-light" required>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                <div class="mb-3">
                                    <label class="form-label">Số nhà</label>
                                    <input type="text" name="houseNumber" class="form-control bg-light" required>
                                </div>
                            </div>
                            <div class="col-8">
                                <div class="mb-3">
                                    <label class="form-label">Tên đường</label>
                                    <input type="text" name="streetName" class="form-control bg-light" required>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hidden Combined Address for Map -->
                        <input type="hidden" name="address" id="fullAddress">
                    </div>

                    <!-- Map Section -->
                    <div class="col-md-6">
                        <h5 class="fw-bold mb-3">Xác Nhận Vị Trí</h5>
                        <div id="map" class="rounded-3 shadow-sm border" style="height: 300px; width: 100%;"></div>
                        <p class="text-muted small mt-2"><i class="bi bi-info-circle me-1"></i>Ghim sẽ cập nhật khi bạn xác minh địa chỉ.</p>
                    </div>

                    <!-- Contact Verification -->
                    <div class="col-12 mt-4">
                        <div class="card bg-light border-0 p-4">
                            <h5 class="fw-bold mb-3">Xác Minh Liên Hệ</h5>
                            <div class="input-group mb-3">
                                <span class="input-group-text bg-white border-end-0"><i class="bi bi-telephone"></i></span>
                                <input type="tel" name="phone" class="form-control bg-white border-start-0" placeholder="Số điện thoại" required>
                                <button class="btn btn-outline-secondary" type="button" id="btnSendOtp" onclick="sendOtp()">Gửi mã OTP</button>
                            </div>
                            <div class="input-group mb-3 d-none" id="otpGroup">
                                <input type="text" class="form-control" placeholder="Nhập mã OTP 6 chữ số">
                                <button class="btn btn-success" type="button" onclick="verifyOtp()">Xác nhận</button>
                            </div>
                            <small class="text-success d-none" id="otpVerified"><i class="bi bi-check-circle-fill me-1"></i>Số điện thoại đã xác minh</small>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between align-items-center mt-5">
                    <button type="submit" name="submitAction" value="save" class="btn btn-link text-muted text-decoration-none">Lưu nháp</button>
                    <button type="submit" name="submitAction" value="next" class="btn btn-warning btn-lg px-5 shadow-sm rounded-pill text-white">
                        Xem lại chi tiết <i class="bi bi-arrow-right ms-2"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
    // Initialize Map (Default to Saigon)
    var map = L.map('map').setView([10.8231, 106.6297], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    var marker = L.marker([10.8231, 106.6297]).addTo(map);

    function sendOtp() {
        // Mock Send
        document.getElementById('btnSendOtp').disabled = true;
        document.getElementById('btnSendOtp').innerText = "Đã gửi!";
        document.getElementById('otpGroup').classList.remove('d-none');
    }

    function verifyOtp() {
        // Mock Verify
        document.getElementById('otpGroup').classList.add('d-none');
        document.getElementById('otpVerified').classList.remove('d-none');
    }
    
    // Simple mock geocode update
    document.querySelectorAll('input[type=text]').forEach(item => {
        item.addEventListener('blur', event => {
            // In a real app, call Nominatim API here to get Lat/Long
        })
    });
</script>

<style>
    .onboarding-container {
        padding: 4rem 1rem;
        min-height: 85vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .glass-panel {
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }

    .fade-in {
        animation: fadeIn 0.6s ease-out;
    }

    @@keyframes fadeIn {
        from { opacity: 0; margin-top: 20px; }
        to { opacity: 1; margin-top: 0; }
    }
</style>
