@model IEnumerable<Unistay_Web.Models.Chat.Conversation>
@{
    ViewData["Title"] = "Tin nhắn"; // Vietnamese as per other pages
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/messages.css" asp-append-version="true" />

<div class="messenger-wrapper" id="messenger-app">
    <!-- List Sidebar -->
    <div class="messenger-sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Tin nhắn</h2>
            <button class="btn-icon" data-bs-toggle="modal" data-bs-target="#newChatModal" title="Tin nhắn mới">
                <i class="bi bi-pencil-square"></i>
            </button>
        </div>
        
        <div class="search-container">
            <div class="search-box-wrapper">
                <i class="bi bi-search search-icon-abs"></i>
                <input type="text" class="search-input" id="conversation-search" placeholder="Tìm kiếm cuộc trò chuyện...">
            </div>
        </div>

        <div class="conversation-list" id="conversation-list">
             <div class="text-center mt-5 text-muted">
                <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                <p class="mt-2 small">Đang tải tin nhắn...</p>
            </div>
        </div>
    </div>

    <!-- Chat Area -->
    <div class="chat-main" id="chat-main">
        <!-- Empty State -->
        <div class="chat-placeholder" id="chat-placeholder">
            <i class="bi bi-chat-dots-fill"></i>
            <h3>Chào mừng bạn đến với Unistay Chat</h3>
            <p>Chọn một cuộc trò chuyện để bắt đầu kết nối với bạn bè.</p>
        </div>

        <!-- Active Interface -->
        <div class="active-chat-container" id="chat-interface" style="display: none;">
            <!-- Header -->
            <div class="chat-header">
                <div class="d-flex align-items-center">
                    <button class="back-btn-mobile" id="mobile-back-btn">
                        <i class="bi bi-arrow-left"></i>
                    </button>
                    <div class="chat-user-info">
                        <div class="position-relative">
                            <img src="/images/default-avatar.png" class="user-avatar" id="header-avatar" alt="Avatar">
                            <div class="status-indicator" id="header-status-indicator"></div>
                        </div>
                        <div>
                            <h4 class="chat-header-name" id="header-name">Tên người dùng</h4>
                            <span class="chat-header-status" id="header-status-text">Đang hoạt động</span>
                        </div>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn-icon" title="Gọi thoại"><i class="bi bi-telephone-fill"></i></button>
                    <button class="btn-icon" title="Gọi video"><i class="bi bi-camera-video-fill"></i></button>
                    <button class="btn-icon" title="Thông tin"><i class="bi bi-info-circle-fill"></i></button>
                </div>
            </div>

            <!-- Messages List -->
            <div class="messages-area" id="messages-container">
                <!-- Messages will be injected here -->
            </div>

            <!-- Input Area -->
            <div class="chat-input-area">
                <div class="input-actions-left">
                    <button class="btn-attach" onclick="document.getElementById('file-upload').click()">
                        <i class="bi bi-image"></i>
                    </button>
                    <button class="btn-attach">
                        <i class="bi bi-paperclip"></i>
                    </button>
                </div>
                
                <div class="chat-input-wrapper">
                    <input type="text" class="chat-input-field" id="message-input" placeholder="Nhập tin nhắn..." autocomplete="off">
                    <i class="bi bi-emoji-smile emoji-trigger"></i>
                </div>

                <button class="btn-send-round" id="send-btn">
                    <i class="bi bi-send-fill"></i>
                </button>

                <input type="file" id="file-upload" hidden multiple accept="image/*,.pdf,.doc,.docx">
            </div>
        </div>
    </div>
</div>

<!-- New Chat Modal -->
<div class="modal fade" id="newChatModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-panel" style="background: var(--bg-surface); border: 1px solid var(--border-color);">
            <div class="modal-header border-bottom border-secondary">
                <h5 class="modal-title text-white">Tin nhắn mới</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="input-group mb-3">
                    <span class="input-group-text bg-transparent border-secondary text-white"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control bg-transparent border-secondary text-white" id="user-search-input" placeholder="Tìm theo tên hoặc email...">
                </div>
                <div id="search-results-list" class="list-group list-group-flush">
                    <!-- Results -->
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/microsoft/signalr/dist/browser/signalr.js"></script>
    <script src="~/js/messages.js"></script>
    <!-- Use Bootstrap Icons if not already included in layout, assumed to be there or FontAwesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
}
