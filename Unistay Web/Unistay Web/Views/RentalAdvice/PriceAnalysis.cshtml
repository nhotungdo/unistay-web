@model Unistay_Web.Models.RentalAdvice.PriceTrend

@{
    ViewData["Title"] = "Ph√¢n T√≠ch Gi√° Th·ªã Tr∆∞·ªùng";
    var maxPrice = Model.MonthlyAverages.Values.Any() ? Model.MonthlyAverages.Values.Max() : 1000000;
}

<div class="bg-light min-vh-100 py-5">
    <div class="container-fluid px-3 px-lg-4">

        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb bg-transparent p-0">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index" class="text-decoration-none text-primary">Trang Ch·ªß</a></li>
                <li class="breadcrumb-item"><a asp-controller="RentalAdvice" asp-action="Index" class="text-decoration-none text-primary">T∆∞ V·∫•n
                        Thu√™</a></li>
                <li class="breadcrumb-item active" aria-current="page">Ph√¢n T√≠ch Gi√°</li>
            </ol>
        </nav>

        <!-- Header Section with Gradient Background -->
        <div class="mb-5">
            <div class="bg-gradient-primary rounded-4 p-5 text-white shadow-sm">
                <div class="d-flex justify-content-between align-items-start gap-3 flex-wrap">
                    <div class="flex-grow-1">
                        <h1 class="display-4 fw-bold mb-2">Ph√¢n T√≠ch Gi√° Th·ªã Tr∆∞·ªùng</h1>
                        <p class="lead text-white-75 mb-0">
                            Xu h∆∞·ªõng gi√° thu√™ tr·ª±c tuy·∫øn cho <strong>@Model.AreaName</strong>
                        </p>
                    </div>
                    <button class="btn btn-white btn-lg rounded-pill shadow-sm d-flex align-items-center gap-2"
                        onclick="window.print()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 6 2 18 2 18 9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                        In B√°o C√°o
                    </button>
                </div>
            </div>
        </div>

        <!-- Area Selector -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="bg-white rounded-3 p-4 shadow-sm border-0">
                    <div class="d-flex align-items-center gap-3 flex-wrap">
                        <label class="fw-semibold text-dark mb-0">Ch·ªçn Khu V·ª±c:</label>
                        <div class="btn-group" role="group">
                            <a href="?area=Downtown"
                                class="btn btn-outline-primary @(Model.AreaName == "Trung T√¢m" || Model.AreaName == "Downtown" ? "active" : "")">
                                <span>üèôÔ∏è</span> Trung T√¢m
                            </a>
                            <a href="?area=Suburb"
                                class="btn btn-outline-primary @(Model.AreaName == "Ngo·∫°i √î" || Model.AreaName == "Suburb" ? "active" : "")">
                                <span>üè°</span> Ngo·∫°i √î
                            </a>
                            <a href="?area=University"
                                class="btn btn-outline-primary @(Model.AreaName == "L√†ng ƒê·∫°i H·ªçc" || Model.AreaName == "University" ? "active" : "")">
                                <span>üéì</span> L√†ng ƒê·∫°i H·ªçc
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Metrics Grid -->
        <div class="row g-4 mb-5">
            <!-- Forecast Card -->
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 shadow-sm border-0 rounded-3 transition-hover"
                    style="transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <p class="text-muted small fw-bold text-uppercase mb-2">D·ª± B√°o Th√°ng T·ªõi</p>
                                <h2 class="display-6 fw-bold text-primary mb-0">
                                    @((Model.ProjectedPriceNextMonth / 1000000m).ToString("0.##"))<span
                                        class="fs-5 ms-1">tr</span>
                                </h2>
                            </div>
                            <div class="bg-primary-soft rounded-3 p-3">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" class="text-primary">
                                    <path d="M23 6l-9.5 9.5-5-5L1 18"></path>
                                    <path d="M17 6h6v6"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="badge bg-success bg-opacity-25 text-success rounded-pill">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="3" class="me-1" style="display: inline;">
                                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                                <polyline points="17 6 23 6 23 12"></polyline>
                            </svg>
                            +2.4% TƒÉng tr∆∞·ªüng
                        </div>
                    </div>
                </div>
            </div>

            <!-- Best Time Card -->
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 shadow-sm border-0 rounded-3 transition-hover"
                    style="transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <p class="text-muted small fw-bold text-uppercase mb-2">Th·ªùi ƒêi·ªÉm V√†ng</p>
                                <h2 class="display-6 fw-bold text-success mb-0">@Model.BestTimeToRent</h2>
                            </div>
                            <div class="bg-success-soft rounded-3 p-3">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" class="text-success">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                            </div>
                        </div>
                        <p class="text-muted small mb-0">Th·ªùi ƒëi·ªÉm l√Ω t∆∞·ªüng ƒë·ªÉ thu√™ v·ªõi gi√° t·ªët nh·∫•t</p>
                    </div>
                </div>
            </div>

            <!-- Market Status Card -->
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 shadow-sm border-0 rounded-3 transition-hover"
                    style="transition: transform 0.3s ease, box-shadow 0.3s ease;">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <p class="text-muted small fw-bold text-uppercase mb-2">Tr·∫°ng Th√°i Th·ªã Tr∆∞·ªùng</p>
                                <h2
                                    class="display-6 fw-bold @(Model.MarketStatus == "Hot" ? "text-danger" : "text-info") mb-0">
                                    @Model.MarketStatus
                                </h2>
                            </div>
                            <div
                                class="@(Model.MarketStatus == "Hot" ? "bg-danger-soft" : "bg-info-soft") rounded-3 p-3">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2"
                                    class="@(Model.MarketStatus == "Hot" ? "text-danger" : "text-info")">
                                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                </svg>
                            </div>
                        </div>
                        <p class="text-muted small mb-0">
                            <span
                                class="badge @(Model.MarketStatus == "Hot" ? "bg-danger-soft text-danger" : "bg-info-soft text-info") rounded-pill me-2">
                                <span class="status-indicator @(Model.MarketStatus == "Hot" ? "bg-danger" : "bg-info")"
                                    style="display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 4px;"></span>
                                M·ª©c ƒë·ªô c·∫°nh tranh
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Price Trend Chart -->
        <div class="card shadow-sm border-0 rounded-3 mb-5">
            <div class="card-body p-4 p-lg-5">
                <div class="mb-4">
                    <h3 class="card-title fw-bold mb-2">Bi·∫øn ƒê·ªông Gi√° 6 Th√°ng</h3>
                    <p class="text-muted small mb-0">Ph√¢n t√≠ch xu h∆∞·ªõng gi√° thu√™ trung b√¨nh t·∫°i khu v·ª±c</p>
                </div>

                <!-- Chart Legend -->
                <div class="d-flex align-items-center gap-4 mb-4 flex-wrap">
                    <div class="d-flex align-items-center gap-2">
                        <span class="chart-legend-dot bg-primary rounded" style="width: 12px; height: 12px;"></span>
                        <span class="text-muted small">Gi√° Trung B√¨nh</span>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <span class="chart-legend-dot bg-primary rounded"
                            style="width: 12px; height: 12px; opacity: 0.4;"></span>
                        <span class="text-muted small">D·ª± B√°o</span>
                    </div>
                </div>

                <!-- Bar Chart -->
                <div style="height: 350px; position: relative;">
                    <div class="d-flex align-items-end justify-content-between h-100 gap-2 gap-md-3 px-3 pb-4 border-bottom border-start"
                        style="border-color: #dee2e6;">
                        @foreach (var item in Model.MonthlyAverages)
                        {
                            var heightPct = (item.Value / maxPrice) * 100;
                            <div class="flex-grow-1 d-flex flex-column align-items-center h-100 position-relative group">
                                <div class="w-100 h-100 d-flex align-items-end justify-content-center position-relative"
                                    style="cursor: pointer;" title="@item.Value.ToString("N0") VNƒê">
                                    <!-- Hover Tooltip -->
                                    <div class="position-absolute bottom-100 mb-3 bg-dark text-white px-3 py-2 rounded-2 text-center opacity-0 transition-opacity"
                                        style="white-space: nowrap; z-index: 10; pointer-events: none;"
                                        id="tooltip-@item.Key">
                                        <div class="fw-bold">@item.Value.ToString("N0")</div>
                                        <div class="small">VNƒê</div>
                                    </div>

                                    <!-- Bar -->
                                    <div class="w-100 rounded-top-3 bg-primary transition-transform"
                                        style="height: @heightPct%; opacity: 0.85; min-height: 20px; cursor: pointer;"
                                        onmouseover="document.getElementById('tooltip-@item.Key').classList.remove('opacity-0'); document.getElementById('tooltip-@item.Key').classList.add('opacity-100');"
                                        onmouseout="document.getElementById('tooltip-@item.Key').classList.add('opacity-0'); document.getElementById('tooltip-@item.Key').classList.remove('opacity-100');">
                                    </div>
                                </div>
                                <span class="mt-3 small fw-500 text-muted">Thg @item.Key</span>
                            </div>
                        }
                    </div>
                </div>

                <!-- Y-axis Labels -->
                <div class="mt-3 d-flex justify-content-between px-3 text-muted small">
                    <span>0</span>
                    <span></span>
                    <span>@((maxPrice / 2000000m).ToString("0.#"))tr</span>
                    <span></span>
                    <span>@((maxPrice / 1000000m).ToString("0.#"))tr</span>
                </div>
            </div>
        </div>

        <!-- Additional Insights -->
        <div class="row g-4">
            <!-- Market Insights Card -->
            <div class="col-lg-6">
                <div class="card shadow-sm border-0 rounded-3">
                    <div class="card-body p-4">
                        <h5 class="card-title fw-bold mb-3 d-flex align-items-center gap-2">
                            <span class="badge bg-primary rounded-circle"
                                style="width: 8px; height: 8px; padding: 0;"></span>
                            Ph√¢n T√≠ch Th·ªã Tr∆∞·ªùng
                        </h5>
                        <ul class="list-unstyled">
                            <li class="mb-3 pb-3 border-bottom">
                                <span class="text-muted small">Gi√° Trung B√¨nh:</span>
                                <strong class="d-block text-primary fs-5">@((Model.MonthlyAverages.Values.Average() /
                                                                        1000000m).ToString("0.##")) tri·ªáu VNƒê</strong>
                            </li>
                            <li class="mb-3 pb-3 border-bottom">
                                <span class="text-muted small">Gi√° Cao Nh·∫•t:</span>
                                <strong class="d-block text-danger fs-5">@((Model.MonthlyAverages.Values.Max() /
                                                                        1000000m).ToString("0.##")) tri·ªáu VNƒê</strong>
                            </li>
                            <li>
                                <span class="text-muted small">Gi√° Th·∫•p Nh·∫•t:</span>
                                <strong class="d-block text-success fs-5">@((Model.MonthlyAverages.Values.Min() /
                                                                        1000000m).ToString("0.##")) tri·ªáu VNƒê</strong>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Recommendations Card -->
            <div class="col-lg-6">
                <div class="card shadow-sm border-0 rounded-3">
                    <div class="card-body p-4">
                        <h5 class="card-title fw-bold mb-3 d-flex align-items-center gap-2">
                            <span class="badge bg-success rounded-circle"
                                style="width: 8px; height: 8px; padding: 0;"></span>
                            L·ªùi Khuy√™n
                        </h5>
                        <div class="alert alert-info border-0 rounded-2 mb-0" role="alert">
                            <strong>üí° M·∫πo:</strong> D·ª±a tr√™n xu h∆∞·ªõng hi·ªán t·∫°i, <strong>@Model.BestTimeToRent</strong>
                            l√† th·ªùi ƒëi·ªÉm t·ªët nh·∫•t ƒë·ªÉ k√Ω h·ª£p ƒë·ªìng thu√™ v·ªõi gi√° h·ª£p l√Ω.
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .text-white-75 {
        color: rgba(255, 255, 255, 0.75) !important;
    }

    .bg-primary-soft,
    .bg-success-soft,
    .bg-danger-soft,
    .bg-info-soft {
        background-color: rgba(102, 126, 234, 0.1);
    }

    .bg-success-soft {
        background-color: rgba(16, 185, 129, 0.1);
    }

    .bg-danger-soft {
        background-color: rgba(239, 68, 68, 0.1);
    }

    .bg-info-soft {
        background-color: rgba(59, 130, 246, 0.1);
    }

    .text-success {
        color: #10b981 !important;
    }

    .text-info {
        color: #3b82f6 !important;
    }

    .transition-hover {
        cursor: pointer;
    }

    .transition-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12) !important;
    }

    .status-indicator {
        animation: pulse-indicator 2s infinite;
    }

    @@keyframes pulse-indicator {
        0% {
            box-shadow: 0 0 0 0 currentColor;
            opacity: 1;
        }

        70% {
            box-shadow: 0 0 0 6px rgba(0, 0, 0, 0);
            opacity: 0;
        }

        100% {
            box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
            opacity: 0;
        }
    }

    .transition-transform {
        transition: height 0.3s ease, opacity 0.3s ease, transform 0.3s ease;
    }

    .transition-transform:hover {
        transform: scaleY(1.1);
        opacity: 1;
    }

    .transition-opacity {
        transition: opacity 0.2s ease;
    }

    @@media (max-width: 768px) {
        .display-4 {
            font-size: 1.75rem;
        }

        .display-6 {
            font-size: 1.25rem;
        }
    }

    .breadcrumb {
        background-color: transparent !important;
    }

    .breadcrumb-item.active {
        color: #6c757d;
    }

    .btn-group .btn {
        border-radius: 0.375rem;
        margin-right: 0.5rem;
    }

    .btn-group .btn.active {
        background-color: #667eea;
        border-color: #667eea;
        color: white;
    }

    .btn-group .btn:hover {
        background-color: #f3f4f6;
        border-color: #667eea;
    }

    .btn-group .btn.active:hover {
        background-color: #667eea;
    }

    .min-vh-100 {
        min-height: 100vh;
    }

    .rounded-3 {
        border-radius: 0.5rem !important;
    }

    .rounded-4 {
        border-radius: 1rem !important;
    }

    .fw-500 {
        font-weight: 500;
    }

    @@media print {
        .btn-white {
            display: none;
        }
    }
</style>