@model Unistay_Web.Models.RentalAdvice.PriceTrend

@{
    ViewData["Title"] = "Phân Tích Giá";
    var maxPrice = Model.MonthlyAverages.Values.Any() ? Model.MonthlyAverages.Values.Max() : 1000;
}

<div class="container py-5">
    <div class="row mb-5 align-items-end">
        <div class="col-md-8">
            <h1 class="fw-bold mb-2">Xu Hướng Giá Thuê</h1>
            <p class="text-muted mb-0">Dữ liệu thị trường mới nhất tại khu vực <strong class="text-primary">@Model.AreaName</strong></p>
        </div>
        <div class="col-md-4 text-md-end">
            <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="areaDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    @Model.AreaName
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="areaDropdown">
                    <li><a class="dropdown-item" href="?area=Downtown">Trung tâm</a></li>
                    <li><a class="dropdown-item" href="?area=Suburb">Ngoại ô</a></li>
                    <li><a class="dropdown-item" href="?area=University">Khu đại học</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="glass-card p-4 text-center h-100">
                <small class="text-muted text-uppercase fw-bold">Dự Báo Tháng Tới</small>
                <div class="display-4 fw-bold text-primary my-2">
                    @Model.ProjectedPriceNextMonth.ToString("N0")
                </div>
                <div class="text-muted small">VNĐ / tháng</div>
                <div class="mt-3">
                    <span class="badge bg-success-soft text-success">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                        +2.5% vs tháng trước
                    </span>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="glass-card p-4 text-center h-100">
                <small class="text-muted text-uppercase fw-bold">Thời Điểm Tốt Nhất</small>
                <div class="display-4 fw-bold text-success my-2">
                    @Model.BestTimeToRent
                </div>
                <div class="text-muted small">để thuê phòng giá tốt</div>
            </div>
        </div>
        <div class="col-md-4">
             <div class="glass-card p-4 text-center h-100">
                <small class="text-muted text-uppercase fw-bold">Trạng Thái Thị Trường</small>
                <div class="display-4 fw-bold @(Model.MarketStatus=="Hot" ? "text-danger" : "text-info") my-2">
                    @Model.MarketStatus
                </div>
                <div class="text-muted small">Cạnh tranh cao</div>
            </div>
        </div>
    </div>

    <!-- Pricing Chart (CSS Only) -->
    <div class="glass-card p-5">
        <h3 class="fw-bold mb-5">Biến Động Giá 6 Tháng Qua</h3>
        
        <div class="chart-container" style="height: 300px; display: flex; align-items: flex-end; gap: 20px; padding-left: 50px; position: relative;">
            <!-- Y Axis Labels -->
            <div class="position-absolute start-0 h-100 d-flex flex-column justify-content-between text-muted small pe-3 border-end" style="width: 50px; bottom: 0;">
                <span>@((maxPrice * 1.0m).ToString("N0"))</span>
                <span>@((maxPrice * 0.75m).ToString("N0"))</span>
                <span>@((maxPrice * 0.5m).ToString("N0"))</span>
                <span>@((maxPrice * 0.25m).ToString("N0"))</span>
                <span>0</span>
            </div>

            @foreach (var item in Model.MonthlyAverages)
            {
                var percentage = (item.Value / maxPrice) * 100;
                <div class="flex-grow-1 d-flex flex-column align-items-center group">
                    <div class="w-100 bg-primary-soft rounded-top position-relative bar-hover" style="height: @percentage%; background: rgba(99, 102, 241, 0.2); transition: height 0.5s;">
                         <div class="position-absolute bottom-100 start-50 translate-middle-x mb-2 bg-dark text-white text-xs py-1 px-2 rounded opacity-0 transition-opacity">
                            @item.Value.ToString("N0")
                        </div>
                    </div>
                    <span class="mt-3 text-muted small fw-bold">@item.Key</span>
                </div>
            }
        </div>
    </div>
</div>

<style>
.bar-hover:hover {
    background: rgba(99, 102, 241, 0.6) !important;
}
.bar-hover:hover .opacity-0 {
    opacity: 1 !important;
}
.transition-opacity { transition: opacity 0.2s; }
</style>
